{"version":3,"file":"index.js","sources":["../src/pixabay-api.js","../src/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nconst BASE_URL = 'https://pixabay.com/api/';\nconst API_KEY = '54359388-9cf15bfeabb0906e8f4ff86d6';\n\nexport async function fetchImages(query, page = 1, perPage = 40) {\n  const { data } = await axios.get(BASE_URL, {\n    params: {\n      key: API_KEY,\n      q: query,\n      image_type: 'photo',\n      orientation: 'horizontal',\n      safesearch: true,\n      page,\n      per_page: perPage,\n    },\n  });\n\n  \n  return data;\n}\n","function escapeHtml(str) {\n  return String(str)\n    .replaceAll('&', '&amp;')\n    .replaceAll('<', '&lt;')\n    .replaceAll('>', '&gt;')\n    .replaceAll('\"', '&quot;')\n    .replaceAll(\"'\", '&#039;');\n}\n\nexport function createGalleryMarkup(images) {\n  return images\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => {\n        const safeTags = escapeHtml(tags);\n\n        return `\n<li class=\"card\">\n  <a class=\"card-link\" href=\"${largeImageURL}\">\n    <img class=\"card-img\" src=\"${webformatURL}\" alt=\"${safeTags}\" loading=\"lazy\" />\n  </a>\n\n  <div class=\"meta\">\n    <div class=\"meta-item\">\n      <span class=\"meta-title\">Likes</span>\n      <span class=\"meta-value\">${likes}</span>\n    </div>\n    <div class=\"meta-item\">\n      <span class=\"meta-title\">Views</span>\n      <span class=\"meta-value\">${views}</span>\n    </div>\n    <div class=\"meta-item\">\n      <span class=\"meta-title\">Comments</span>\n      <span class=\"meta-value\">${comments}</span>\n    </div>\n    <div class=\"meta-item\">\n      <span class=\"meta-title\">Downloads</span>\n      <span class=\"meta-value\">${downloads}</span>\n    </div>\n  </div>\n</li>`;\n      }\n    )\n    .join('');\n}\n","import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport { fetchImages } from './pixabay-api';\nimport { createGalleryMarkup } from './render-functions';\nimport './css/styles.css';\n\nconst formEl = document.querySelector('.search-form');\nconst galleryEl = document.querySelector('.gallery');\nconst loadMoreBtnEl = document.querySelector('.load-more');\n\nconst searchLoaderEl = document.getElementById('searchLoader');\nconst loadMoreLoaderEl = document.getElementById('loadMoreLoader');\n\nconst lightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nlet queryGlobal = '';\nlet page = 1;\nconst perPage = 40;\nlet totalHits = 0;\n\nasync function paintUI() {\n  await new Promise(requestAnimationFrame);\n}\n\nfunction showSearchLoader() {\n  if (!searchLoaderEl) return;\n  searchLoaderEl.classList.add('is-visible');\n}\nfunction hideSearchLoader() {\n  if (!searchLoaderEl) return;\n  searchLoaderEl.classList.remove('is-visible');\n}\n\nfunction showLoadMoreLoader() {\n  if (!loadMoreLoaderEl) return;\n  loadMoreLoaderEl.classList.add('is-visible');\n}\nfunction hideLoadMoreLoader() {\n  if (!loadMoreLoaderEl) return;\n  loadMoreLoaderEl.classList.remove('is-visible');\n}\n\nfunction showLoadMore() {\n  if (!loadMoreBtnEl) return;\n  loadMoreBtnEl.classList.remove('is-hidden');\n}\nfunction hideLoadMore() {\n  if (!loadMoreBtnEl) return;\n  loadMoreBtnEl.classList.add('is-hidden');\n}\nfunction disableLoadMore() {\n  if (!loadMoreBtnEl) return;\n  loadMoreBtnEl.disabled = true;\n}\nfunction enableLoadMore() {\n  if (!loadMoreBtnEl) return;\n  loadMoreBtnEl.disabled = false;\n}\n\nfunction clearGallery() {\n  galleryEl.innerHTML = '';\n}\n\nfunction notifyEmptyQuery() {\n  iziToast.warning({\n    message: 'Please enter a search query.',\n    position: 'topRight',\n  });\n}\nfunction notifyNoResults() {\n  iziToast.info({\n    message:\n      'Sorry, there are no images matching your search query. Please try again!',\n    position: 'topRight',\n  });\n}\nfunction notifyError() {\n  iziToast.error({\n    message: 'Something went wrong. Please try again later.',\n    position: 'topRight',\n  });\n}\nfunction notifyEnd() {\n  iziToast.info({\n    message: \"We're sorry, but you've reached the end of search results\",\n    position: 'topRight',\n  });\n}\n\nfunction smoothScrollAfterAppend() {\n  const firstCard = galleryEl.firstElementChild;\n  if (!firstCard) return;\n\n  const { height } = firstCard.getBoundingClientRect();\n  window.scrollBy({ top: height * 2, behavior: 'smooth' });\n}\n\nasync function runSearch(query) {\n  showSearchLoader();\n  hideLoadMore();\n  await paintUI();\n\n  try {\n    const data = await fetchImages(query, page, perPage);\n    totalHits = data.totalHits;\n\n    if (!data.hits.length) {\n      notifyNoResults();\n      return;\n    }\n\n    const markup = createGalleryMarkup(data.hits);\n    galleryEl.insertAdjacentHTML('beforeend', markup);\n    lightbox.refresh();\n\n    const totalPages = Math.ceil(totalHits / perPage);\n    if (page < totalPages) showLoadMore();\n    else {\n      hideLoadMore();\n      notifyEnd();\n    }\n  } catch {\n    notifyError();\n  } finally {\n    hideSearchLoader();\n  }\n}\n\nasync function runLoadMore() {\n  disableLoadMore();\n  showLoadMoreLoader();\n  await paintUI();\n\n  try {\n    const data = await fetchImages(queryGlobal, page, perPage);\n    totalHits = data.totalHits;\n\n    const markup = createGalleryMarkup(data.hits);\n    galleryEl.insertAdjacentHTML('beforeend', markup);\n    lightbox.refresh();\n\n    const totalPages = Math.ceil(totalHits / perPage);\n    if (page >= totalPages) {\n      hideLoadMore();\n      notifyEnd();\n    }\n  } catch {\n    notifyError();\n  } finally {\n    hideLoadMoreLoader();\n    enableLoadMore();\n  }\n}\n\nformEl.addEventListener('submit', async e => {\n  e.preventDefault();\n\n  const query = e.currentTarget.elements.query.value.trim();\n  if (!query) {\n    clearGallery();\n    hideLoadMore();\n    hideSearchLoader();\n    hideLoadMoreLoader();\n    notifyEmptyQuery();\n    return;\n  }\n\n  queryGlobal = query;\n  page = 1;\n  totalHits = 0;\n\n  clearGallery();\n  await runSearch(queryGlobal);\n\n  formEl.reset();\n});\n\nif (loadMoreBtnEl) {\n  loadMoreBtnEl.addEventListener('click', async () => {\n    page += 1;\n    await runLoadMore();\n    smoothScrollAfterAppend();\n  });\n}\n"],"names":["BASE_URL","API_KEY","fetchImages","query","page","perPage","data","axios","escapeHtml","str","createGalleryMarkup","images","webformatURL","largeImageURL","tags","likes","views","comments","downloads","safeTags","formEl","galleryEl","loadMoreBtnEl","searchLoaderEl","loadMoreLoaderEl","lightbox","SimpleLightbox","queryGlobal","totalHits","paintUI","showSearchLoader","hideSearchLoader","showLoadMoreLoader","hideLoadMoreLoader","showLoadMore","hideLoadMore","disableLoadMore","enableLoadMore","clearGallery","notifyEmptyQuery","iziToast","notifyNoResults","notifyError","notifyEnd","smoothScrollAfterAppend","firstCard","height","runSearch","markup","totalPages","runLoadMore","e"],"mappings":"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"}